<!--- File excel phải có những trường sau, chính xác từng chữ, không dư thừa dấu cách:
	Email cá nhân
	Thời gian nộp phiếu
	Người phê duyệt 1
	Email_NPD1
	Trạng thái_NPD1
	Thời gian thao tác_NPD1
	Ghi chú_NPD1
	Người phê duyệt 2
	Email_NPD2
	Trạng thái_NPD2
	Thời gian thao tác_NPD2
	Ghi chú_NPD2
	Trạng thái chung
	Ngày/ tháng/ năm
	Vận hành
	QC
	Trưởng ca
-->

<!--- Khi sửa html: gồm 3 file: file 1 giao diện chính để người dùng điền, file 2 chép vào automate, file 3 nháp
	- Sửa hoàn hảo trên file 1, bật F5 để kiểm tra có lỗi font, giao diện...
	- Sau khi hoàn chỉnh mới copy file này sang file thứ 2.
	- Sau đó:
	 	+	Copy từng phần trên file thứ 2 cần sửa
		+	Chép ra file 3 nháp
		+ 	Ctrl F để tìm và sửa
		+	Dán ngược lại vào file 2 để tránh sửa luôn các phần không cần thiết
	- Sau khi sửa xong 3 phần, xóa hết phần comment rồi mới chép vào automate
-->


<!DOCTYPE html>

<html>

<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>

<style>
    textarea:enabled,
    input[type=text]:enabled,
    select:enabled {
        background-color: beige;
    }

    textarea:disabled,
    input[type=text]:disabled,
    select:disabled {
        background-color: lightgray;
    }

    input[type=text],
    select {
        width: 100%;
        padding: 12px 20px;
        margin: 0;
        display: block;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    button:enabled {
        background-color: #4CAF50;
    }

    button:disabled {
        background-color: lightgray;
    }

    * {
        font-size: 100%;
        font-family: Tahoma, sans-serif;
    }

    @media print {
        .noPrint {
            display: none;
        }
    }

    input[type=button] {
        width: 20%;
        background-color: #4CAF50;
        color: white;
        padding: 14px 20px;
        margin: 8px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    button {
        width: 20%;
        background-color: #4CAF50;
        color: white;
        padding: 14px 20px;
        margin: 8px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    input[type="submit"][value="Chỉnh sửa"] {
        background-color: green;
        color: white;
    }

    input[type="button"][value="Tạm dừng"] {
        background-color: red;
        color: white;
    }

    input:focus:invalid {
        box-shadow: none;
    }

    select {
        width: 100%;
        text-overflow: ellipsis;
        overflow: hidden;
        height: max-content;
        overflow: visible;
        font-size: x-small;
        word-wrap: break-word;
        white-space: nowrap;
        margin: 0%;
        padding: auto;
        overflow: visible;
    }

    select option {
        margin: 0%;
        width: 100%;
        text-overflow: ellipsis;
        overflow: visible;
        white-space: nowrap;
        word-wrap: break-word;
        overflow: visible;
    }

    input[type=submit]:hover {
        background-color: #45a049;
    }

    tr {
        height: 50px;
    }


    div {
        border-radius: 5px;
        background-color: rgb(255, 255, 255);
        padding: 20px;
    }

    .table td {
        padding: 0.2rem 0.5rem;
        text-align: center;
    }

    textarea,
    input[type=text],
    input[type=date],
    select {
        overflow: inherit;
        display: block;
        box-sizing: border-box;
        border: 0px;
        resize: none;
        width: 100%;
    }


    table,
    th,
    td {
        border-collapse: collapse;
        border: 1px solid;
        text-align: center;
    }

    table {
        width: 100%;
    }
    </style>
</style>
<style type="text/css" media="print">
	@page { size: landscape; }
  </style>

<body>
    <input onclick="enable_disable()" type="button" class="slide-toggle" value="Chỉnh sửa" style=" float: right;">
    <form class='form' id="GFG">



        <!--- Sửa phần 1: Phần tiêu đề form
		Ở file render trên automata, sửa từ:
			1. <textarea id=" thành @{triggerBody()?['
			2. "></textarea> thành ']}
			3. <input type="text" autocomplete="email" maxlength="60" id="Email cá nhân" pattern="[^@]+@[^@]+\.[a-zA-Z]{2,6}" required=""> thành
			@{triggerBody()?['Email cá nhân']}
			4. <input type="date" id="Ngày/ tháng/ năm" required=""> thành
			@{outputs('Add_a_row_into_a_table')?['body/Ngày~1 tháng~1 năm']}
			
		-->

        <table table-layout="fixed">
            <tr>
                <td colspan="12" rowspan="4" style="font-weight: bold;">BIỂU MẪU GHI NHẬN DỪNG MÁY TRONG CA</td>
                <td>Mã tài liệu</td>
                <td>VHW/SX/TT-001/BM03</td>
            </tr>
            <tr>
                <td>Lần ban hành</td>
                <td>09</td>
            </tr>
            <tr>
                <td>Ngày hiệu lực</td>
                <td>8/25/2023</td>
            </tr>
            <tr>
                <td>Số trang:</td>
                <td>1/1</td>
            </tr>
            <tr>
                <td width="5%" style="font-weight: bold; overflow:auto;word-break:normal;">Ngày/ tháng/ năm</td>
                <td><input type="date" id="Ngày/ tháng/ năm" required=""></td>
                <td width="5%" style="font-weight: bold;">Vận hành</td>
                <td>
                    <textarea id="Vận hành"></textarea>
                </td>
                <td width="5%" style="font-weight: bold;">Email cá nhân</td>
                <td>
                    <input type="text" autocomplete="email" maxlength="60" id="Email cá nhân"
                        pattern="[^@]+@[^@]+\.[a-zA-Z]{2,6}" required="">
                </td>
                <td width="5%" style="font-weight: bold;">Sản phẩm</td>
                <td>
                    <textarea id="Sản phẩm"></textarea>
                </td>
                <td width="5%" style="font-weight: bold;">Trưởng ca</td>
                <td>
                     <select id="Trưởng ca">
                        <option value="Lục Thế Quang">Lục Thế Quang</option>
                        <option value="Nguyễn Văn Hùng">Nguyễn Văn Hùng</option>
                        <option value="Nguyễn Văn Trung">Nguyễn Văn Trung</option>
                        <option value="Nguyễn Công Thành">Nguyễn Công Thành</option>
                        <option value="Nguyễn Trung Bình">Nguyễn Trung Bình</option>
                        <option value="Nguyễn Duy Hưng">Nguyễn Duy Hưng</option>
                        <option value="Nguyễn Văn Đoan">Nguyễn Văn Đoan</option>
                        <option value="Đồng Quang Sang">Sang</option>
                        <option value="Nguyễn Văn Hùng_PET">Hùng_PET</option>
                        <option value="Phạm Thanh Tuấn">Tuấn</option>
                        <option value="Phạm Văn Trường">Trường</option>
                        <option value="Vương Minh Tân">Tân</option>
                        <option value="Hồ Quang Đông">Đông</option>
                    </select>
                </td>
                <td width="5%" style="font-weight: bold;">Bộ phận</td>
                <td>
                    <select id="Bộ phận">
                        <option value="Line 1">Line 1</option>
                        <option value="Line 2">Line 2</option>
                        <option value="Line 3">Line 3</option>
                        <option value="Line 4">Line 4</option>
                        <option value="Line 5">Line 5</option>
                        <option value="XLN/CB">XLN/CB</option>
                        <option value="PET">Line PET</option>
                    </select>
                </td>
                <td width="5%" style="font-weight: bold;">Ca</td>
                <td>
                    <textarea id="Ca"></textarea>
                </td>
            </tr>
        </table>


        <!--- Sửa phần 1: Phần tiêu đề form-->


        <br>



        <!--- Sửa phần 2: Phần nội dung form:
			Ở file render trên automata, sửa từ:
			1. <textarea id=" thành @{triggerBody()?['
			2. "></textarea> thành ']}
			3. <input type="checkbox" id=" thành <input type="checkbox" @{triggerBody()?['
			4. " value="uncheck" thành ']}

		-->






        <table>
            <tr style="font-weight: bold;">
                <td>Mô tả dừng máy</td>
                <td>Nguyên nhân dừng máy</td>
                <td>Hành động khắc phục</td>
                <td colspan="4">Thời gian dừng máy</td>
                <td colspan="6">Phân loại</td>
            </tr>
            <tr style="font-weight: bold;">
                <td>Ghi rõ hiện trạng dừng máy, vị trí càng chi tiết càng tốt</td>
                <td>Ghi rõ nguyên nhân, càng chi tiết càng tốt</td>
                <td>-Ghi rõ các bước khắc phục để máy chạy lại<br>-Nếu có thay spare part thì cập nhật số lượng<br>-Nếu
                    là down time thì có thể ghi theo kế hoạch</td>
                <td>Từ (h)</td>
                <td>Đến (h)</td>
                <td>Số phút</td>
                <td>Số lần</td>
                <td>1. Stop: là lỗi dừng ngắn &lt;15 phút.</td>
                <td>2. Breakdown: là dừng hẳn máy &gt;15 phút, có thể thay thế spare part</td>
                <td>3. Process faiture: là lỗi dừng hẳn máy &gt; 15 phút không thay thế spare part</td>
                <td>4. Supply: cung ứng, lỗi tự nhiên ngoài (chế biến, utility....)</td>
                <td>5. Loss tốc độ: giảm tốc độ máy</td>
                <td>6. Plan downtime : CIP, changer over PM, GHP... theo tần suất</td>
            </tr>
            <tr>
                <td><textarea id="Mô tả-1"></textarea></td>
                <td><textarea id="NN-1"></textarea></td>
                <td><textarea id="HĐ-1"></textarea></td>
                <td><textarea id="Từ (h)-1"></textarea></td>
                <td><textarea id="Đến (h)-1"></textarea></td>
                <td><textarea id="Số phút - 1"></textarea></td>
                <td><textarea id="Số lần-1"></textarea></td>
                <td><input type="checkbox" id="Stop-1" value="uncheck" /></td>
                <td><input type="checkbox" id="Breakdown-1" value="uncheck" /></td>
                <td><input type="checkbox" id="Process-1" value="uncheck" /></td>
                <td><input type="checkbox" id="Supply-1" value="uncheck" /></td>
                <td><input type="checkbox" id="Loss-1" value="uncheck" /></td>
                <td><input type="checkbox" id="Plan-1" value="uncheck" /></td>
            </tr>
            <tr>
                <td><textarea id="Mô tả-2"></textarea></td>
                <td><textarea id="NN-2"></textarea></td>
                <td><textarea id="HĐ-2"></textarea></td>
                <td><textarea id="Từ (h)-2"></textarea></td>
                <td><textarea id="Đến (h)-2"></textarea></td>
                <td><textarea id="Số phút - 2"></textarea></td>
                <td><textarea id="Số lần-2"></textarea></td>
                <td><input type="checkbox" id="Stop-2" value="uncheck" /></td>
                <td><input type="checkbox" id="Breakdown-2" value="uncheck" /></td>
                <td><input type="checkbox" id="Process-2" value="uncheck" /></td>
                <td><input type="checkbox" id="Supply-2" value="uncheck" /></td>
                <td><input type="checkbox" id="Loss-2" value="uncheck" /></td>
                <td><input type="checkbox" id="Plan-2" value="uncheck" /></td>
            </tr>
            <tr>
                <td><textarea id="Mô tả-3"></textarea></td>
                <td><textarea id="NN-3"></textarea></td>
                <td><textarea id="HĐ-3"></textarea></td>
                <td><textarea id="Từ (h)-3"></textarea></td>
                <td><textarea id="Đến (h)-3"></textarea></td>
                <td><textarea id="Số phút - 3"></textarea></td>
                <td><textarea id="Số lần-3"></textarea></td>
                <td><input type="checkbox" id="Stop-3" value="uncheck" /></td>
                <td><input type="checkbox" id="Breakdown-3" value="uncheck" /></td>
                <td><input type="checkbox" id="Process-3" value="uncheck" /></td>
                <td><input type="checkbox" id="Supply-3" value="uncheck" /></td>
                <td><input type="checkbox" id="Loss-3" value="uncheck" /></td>
                <td><input type="checkbox" id="Plan-3" value="uncheck" /></td>
            </tr>
            <tr>
                <td><textarea id="Mô tả-4"></textarea></td>
                <td><textarea id="NN-4"></textarea></td>
                <td><textarea id="HĐ-4"></textarea></td>
                <td><textarea id="Từ (h)-4"></textarea></td>
                <td><textarea id="Đến (h)-4"></textarea></td>
                <td><textarea id="Số phút - 4"></textarea></td>
                <td><textarea id="Số lần-4"></textarea></td>
                <td><input type="checkbox" id="Stop-4" value="uncheck" /></td>
                <td><input type="checkbox" id="Breakdown-4" value="uncheck" /></td>
                <td><input type="checkbox" id="Process-4" value="uncheck" /></td>
                <td><input type="checkbox" id="Supply-4" value="uncheck" /></td>
                <td><input type="checkbox" id="Loss-4" value="uncheck" /></td>
                <td><input type="checkbox" id="Plan-4" value="uncheck" /></td>
            </tr>
            <tr>
                <td><textarea id="Mô tả-5"></textarea></td>
                <td><textarea id="NN-5"></textarea></td>
                <td><textarea id="HĐ-5"></textarea></td>
                <td><textarea id="Từ (h)-5"></textarea></td>
                <td><textarea id="Đến (h)-5"></textarea></td>
                <td><textarea id="Số phút - 5"></textarea></td>
                <td><textarea id="Số lần-5"></textarea></td>
                <td><input type="checkbox" id="Stop-5" value="uncheck" /></td>
                <td><input type="checkbox" id="Breakdown-5" value="uncheck" /></td>
                <td><input type="checkbox" id="Process-5" value="uncheck" /></td>
                <td><input type="checkbox" id="Supply-5" value="uncheck" /></td>
                <td><input type="checkbox" id="Loss-5" value="uncheck" /></td>
                <td><input type="checkbox" id="Plan-5" value="uncheck" /></td>
            </tr>
            <tr>
                <td colspan="3" style="font-weight: bold;">Ghi chú:<br>1.Sự cố này có ảnh hưởng đến Filler dừng
                    máy<br>2.Nếu có ý kiến đề suất bổ
                    sung thêm ý người cập nhật viết rõ vào ô</td>
                <td colspan="10"><textarea id="Ghi chú"></textarea></td>
            </tr>
        </table>




        <br>
        <p><b>Chi tiết cây phê duyệt</b></p>

        <!--- Sửa phần 3: Chi tiết cây phê duyệt: sửa lại TC line nào trực tiếp
        Ở file render trên automata, sửa từ:
        1. id=" thành >@{triggerBody()?['
        2. "> thành ']}
        3. <td colspan="5" id="Thời gian nộp phiếu"></td> thành
    @{outputs('Add_a_row_into_a_table')?['body/Thời gian nộp phiếu']}
-->

        <table>
            <tr>
                <td style="font-weight: bold;">Thời gian nộp phiếu</td>
                <td colspan="5" id="Thời gian nộp phiếu"></td>
            </tr>
            <tr style="font-weight: bold;">
                <td>Cấp phê duyệt</td>
                <td>Người phê duyệt</td>
                <td>Email</td>
                <td>Trạng thái</td>
                <td>Thời gian thao tác</td>
                <td>Ghi chú NPD</td>
            </tr>
            <tr>
                <td>Trưởng ca</td>
                <td id="Người phê duyệt"></td>
                <td id="Email"></td>
                <td id="Trạng thái"></td>
                <td id="Thời gian thao tác"></td>
                <td id="Ghi chú NPD"></td>
            </tr>
        </table>

        <!--- Sửa phần 3: Chi tiết cây phê duyệt: sửa lại TC line nào-->

        <button id='nut' type="submit" style=" float: left;">Nộp kết quả</button>
    </form>

    <button onclick="window.print();" class="noPrint" style=" float: right; background-color: yellow; color:black">Kiểm
        tra kết quả</button>

    <script type="text/javascript">
        $(document).ready(function () {
            $("#GFG :input").prop("disabled", true);
            $(".slide-toggle").click(function () {
                if (this.value == "Chỉnh sửa") {
                    this.value = "Tạm dừng";
                    $("#GFG :input").prop("disabled", false);
                }
                else {
                    this.value = "Chỉnh sửa";
                    $("#GFG :input").prop("disabled", true);
                }
            });
        });
    </script>



    <script>
        $(":checkbox").change(function () {
            $(this).val($(this).is(":checked") ? 'checked' : 'unchecked');
        });

        $(document).ready(function () {
            $(":checkbox").each(function (index) {

                if ($(this).val() ==
                    "Yes")
                    ($(this).prop('checked', true));
            });
        });

        const formE1 = document.querySelector('.form');
        formE1.addEventListener('submit', event => {
            event.preventDefault();
            const formData = new FormData(formE1);
            const submissionTime = new Date().toISOString();
            const data = new URLSearchParams(formData);
            fetch('https://default810604757e7f4ede8d8dbf61f53ca5.28.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/d2c03e7c1a9042f6bde3ea183e5c40c6/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=z6Lzi6czFbYTvL3mfa-u8xzDCMP3egNVzdxZDLo3-k0', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    'Email cá nhân': document.getElementById('Email cá nhân').value,
                    'Thời gian nộp phiếu': submissionTime,
                    'Người phê duyệt': document.getElementById('Trưởng ca').value,
                    'Email': ' ',
                    'Trạng thái': 'Pending',
                    'Thời gian thao tác': '',
                    'Ghi chú NPD': '',
                    'Ngày/ tháng/ năm': document.getElementById('Ngày/ tháng/ năm').value,
                    'Vận hành': document.getElementById('Vận hành').value,
                    'Ca': document.getElementById('Ca').value,
                    'Trưởng ca': document.getElementById('Trưởng ca').value,
                    'Sản phẩm': document.getElementById('Sản phẩm').value,
                    'Bộ phận': document.getElementById('Bộ phận').value,
                    'Mô tả-1': document.getElementById('Mô tả-1').value,
                    'NN-1': document.getElementById('NN-1').value,
                    'HĐ-1': document.getElementById('HĐ-1').value,
                    'Từ (h)-1': document.getElementById('Từ (h)-1').value,
                    'Đến (h)-1': document.getElementById('Đến (h)-1').value,
                    'Số phút - 1': document.getElementById('Số phút - 1').value,
                    'Số lần-1': document.getElementById('Số lần-1').value,
                    'Mô tả-2': document.getElementById('Mô tả-2').value,
                    'NN-2': document.getElementById('NN-2').value,
                    'HĐ-2': document.getElementById('HĐ-2').value,
                    'Từ (h)-2': document.getElementById('Từ (h)-2').value,
                    'Đến (h)-2': document.getElementById('Đến (h)-2').value,
                    'Số phút - 2': document.getElementById('Số phút - 2').value,
                    'Số lần-2': document.getElementById('Số lần-2').value,
                    'Mô tả-3': document.getElementById('Mô tả-3').value,
                    'NN-3': document.getElementById('NN-3').value,
                    'HĐ-3': document.getElementById('HĐ-3').value,
                    'Từ (h)-3': document.getElementById('Từ (h)-3').value,
                    'Đến (h)-3': document.getElementById('Đến (h)-3').value,
                    'Số phút - 3': document.getElementById('Số phút - 3').value,
                    'Số lần-3': document.getElementById('Số lần-3').value,
                    'Mô tả-4': document.getElementById('Mô tả-4').value,
                    'NN-4': document.getElementById('NN-4').value,
                    'HĐ-4': document.getElementById('HĐ-4').value,
                    'Từ (h)-4': document.getElementById('Từ (h)-4').value,
                    'Đến (h)-4': document.getElementById('Đến (h)-4').value,
                    'Số phút - 4': document.getElementById('Số phút - 4').value,
                    'Số lần-4': document.getElementById('Số lần-4').value,
                    'Mô tả-5': document.getElementById('Mô tả-5').value,
                    'NN-5': document.getElementById('NN-5').value,
                    'HĐ-5': document.getElementById('HĐ-5').value,
                    'Từ (h)-5': document.getElementById('Từ (h)-5').value,
                    'Đến (h)-5': document.getElementById('Đến (h)-5').value,
                    'Số phút - 5': document.getElementById('Số phút - 5').value,
                    'Số lần-5': document.getElementById('Số lần-5').value,
                    'Stop-1': document.getElementById('Stop-1').value,
                    'Breakdown-1': document.getElementById('Breakdown-1').value,
                    'Process-1': document.getElementById('Process-1').value,
                    'Supply-1': document.getElementById('Supply-1').value,
                    'Loss-1': document.getElementById('Loss-1').value,
                    'Plan-1': document.getElementById('Plan-1').value,
                    'Stop-2': document.getElementById('Stop-2').value,
                    'Breakdown-2': document.getElementById('Breakdown-2').value,
                    'Process-2': document.getElementById('Process-2').value,
                    'Supply-2': document.getElementById('Supply-2').value,
                    'Loss-2': document.getElementById('Loss-2').value,
                    'Plan-2': document.getElementById('Plan-2').value,
                    'Stop-3': document.getElementById('Stop-3').value,
                    'Breakdown-3': document.getElementById('Breakdown-3').value,
                    'Process-3': document.getElementById('Process-3').value,
                    'Supply-3': document.getElementById('Supply-3').value,
                    'Loss-3': document.getElementById('Loss-3').value,
                    'Plan-3': document.getElementById('Plan-3').value,
                    'Stop-4': document.getElementById('Stop-4').value,
                    'Breakdown-4': document.getElementById('Breakdown-4').value,
                    'Process-4': document.getElementById('Process-4').value,
                    'Supply-4': document.getElementById('Supply-4').value,
                    'Loss-4': document.getElementById('Loss-4').value,
                    'Plan-4': document.getElementById('Plan-4').value,
                    'Stop-5': document.getElementById('Stop-5').value,
                    'Breakdown-5': document.getElementById('Breakdown-5').value,
                    'Process-5': document.getElementById('Process-5').value,
                    'Supply-5': document.getElementById('Supply-5').value,
                    'Loss-5': document.getElementById('Loss-5').value,
                    'Plan-5': document.getElementById('Plan-5').value,

                })
            }).then(res => res.json())
                .then(data => console.log(data))
                .catch(error => console.log(error));
            alert("Đã nộp thành công");
            window.location.reload();
        });
    </script>


</body>

</html>